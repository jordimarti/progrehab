<% @fases.each do |fase| %>
	<% 
		intervencions = Intervencio.where(fase_id: fase.id)
		import_fase = 0
		intervencions.each do |intervencio|
			import_total_intervencio = intervencio.import_obres.to_i + intervencio.import_honoraris.to_i + intervencio.import_taxes.to_i + intervencio.import_altres.to_i
			import_fase += import_total_intervencio
		end
	%>
	<h3 class="titol-fase">FASE <%= fase.posicio %></h3>
	<p class="opcions-fase"><%= t('.import') %>: <%= import_fase %> €</p>
	<div class="light-container container-derrames-fase">
		<div id="derrames">
      <%= render :partial => '/planificacions/llistat_derrames', locals: {fase_id: fase.id} %>
      <% import_derrames = 0 %>
      <% @derrames.where(fase_id: fase.id).each do |derrama| %>
      	<% import_derrames += derrama.import %>
      <% end %>
      <p>
      	Total: <%= import_derrames %> €.
      	<% 
      	diferencia_derrama_fase = import_fase - import_derrames
      	if diferencia_derrama_fase > 0 %>
      		Falten <%= diferencia_derrama_fase %> € per cobrir el cost de la fase. 
      	<% elsif diferencia_derrama_fase < 0
      		diners_sobrants = diferencia_derrama_fase * (-1) %>
      		Sobren <%= diners_sobrants %> €.
      	<% end %>
      </p>
    </div>
    <div class="spacer"></div>


    <%= link_to (new_derrama_path(edifici_id: fase.edifici_id, fase_id: fase.id)), remote: true do %>
      <span class="suma">+</span> <%= t('.afegir_derrama') %>
    <% end %>
	</div>

<% end %>